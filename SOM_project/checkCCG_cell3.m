%% load

load('C:\Balazs\_analysis\SOM\nt_pairs\CCG_matrices3.mat')

%% all 0: CCG not calculated (not enough spikes or no segments)

length(find(all(CCR'==0))) + 412   % 17 pair duplicate

%% inhibition

inh = find(any(CCR(:,27:35)<LCCR(:,27:35),2));

%%

for k = 301:324
    figure(inh(k))
    plot(CCR(inh(k),:))
    hold on
    plot(LCCR(inh(k),:),'Color',[0.7 0.7 0.7])
    plot(UCCR(inh(k),:),'Color',[0.7 0.7 0.7])
    title(num2str(mean(CCR(inh(k),:))))
end

%%

inhibited = [103 217 570 586 587 595 643 672 673 677 ...
     682 685 779 781 784 796 799 822 825 837 850 890 891 894 911 919 923 924 926 928 929 933 934 945 947 960 962 976 987 988 989 990 1004 1060 1067 ...
     1068 1073 1075 1080 1113 1116 1156 1160 1168 1188 1191 1192 1202 1205 1206 1214 1215 1222 1257 1259 1270 1274 1286 1289 1291 1297 1340 1348 1350 1371 1375 ...
     1586 1599 1604 1660 1760 1771 1789 1792 1815 1832 ...
     1879 1892 1939 1980 1992 2029 2033 2034 2064 2070 2131 2140 2240 2287 ...
     2596 2739 2744 2749 2750 2831 2888 2890 2914 2920 2922 2931 2934 2942 2944 2948 2951 2980 2998 3075 ...
     3083 3127 3145 3170 3175 3194 3195 3200 3206 3207 3276 3313 3319];   % 0.045161290322581

%% excitation

exc = find(any(CCR(:,27:35)>UCCR(:,27:35),2));

%%

for k = 351:373
    figure(exc(k))
    plot(CCR(exc(k),:))
    hold on
    plot(LCCR(exc(k),:),'Color',[0.7 0.7 0.7])
    plot(UCCR(exc(k),:),'Color',[0.7 0.7 0.7])
    zoom on
    title(num2str(mean(CCR(exc(k),:))))
end

%%

excited = [30 105 114 139 178 246 321 349 379 472 524 527 528 531 554 565 586 587 664 667 674 ...
    677 682 685 688 705 777 782 784 785 787 788 792 795 798 800 807 814 857 893 912 943 951 952 962 969 976 997 1017 1043 1066 1975 1123 1125 1156 ...
    1202 1207 1208 1212 1214 1217 1218 1222 1228 1256 1258 1260 1270 1271 1272 1273 1274 1282 1285 1286 1289 1297 1308 1335 1340 1342 1350 1352 1356 1363 1366 1370 1372 1379 1380 ...
    1382 1383 1425 1476 1491 1577 1642 1648 1658 1787 1812 1830 1833 1869 1879 1892 ...
    1902 1939 1995 1996 1998 2026 2028 2029 2033 2042 2069 2083 2085 2086 2094 2095 2096 2102 2103 2107 2128 2132 2134 2135 2138 2140 2148 2203 2240 2247 2296 2303 2306 2308 2326 2329 2393 ...
    2444 2467 2543 2545 2553 2719 2720 2737 2739 2793 2797 2801 2802 2807 2811 2814 2815 ...
    2821 2825 2830 2831 2875 2891 2914 2922 2924 2929 2931 2932 2933 2934 2935 2936 2942 2943 2944 2947 2948 2949 2951 2965 2973 2985 3022 3070 3121 3127 3205 ...
    3313 3318 3319 3323 3331 3357 3385 3395 3396 3409 3484 3500];   
sym_excited = [105 528 531 554 565 664 667 674 ...
    705 777 785 787 788 792 795 798 893 912 943 951 952 962 1017 1043 1058 1066 1075 1125 ...
    1207 1214 1217 1256 1260 1270 1271 1285 1286 1335 1340 1350 1356 1363 1366 1372 1380 ...
    1869 1833 1830 1787 1658 1642 1383 ...
    1939 1996 1998 2026 2042 2083 2085 2086 2094 2095 2107 2128 2135 2140 2240 2247 2296 2308 2393 ...
    2467 2543 2720 2739 2797 2801 2802 2807 2811 2815 ...
    3205 2965 2951 2948 2944 2942 2935 2933 2931 2929 2922 2914 2875 2831 2830 2821 ...
    3318 3323 3331 3395 3396 3409];

%%

for k = 51:104
    figure(sym_excited(k))
    plot(CCR(sym_excited(k),:))
    hold on
    plot(LCCR(sym_excited(k),:),'Color',[0.7 0.7 0.7])
    plot(UCCR(sym_excited(k),:),'Color',[0.7 0.7 0.7])
    zoom on
    title(num2str(mean(CCR(sym_excited(k),:))))
end

%%

excited = [30 105 114 139 178 246 321 349 379 472 524 527 528 531 554 565 586 587 674 ...
    677 682 685 688 705 777 782 784 785 787 788 792 795 798 800 807 814 857 893 912 943 951 952 962 969 976 997 1043 1066 1975 1123 1125 1156 ...
    1202 1208 1212 1214 1217 1218 1222 1228 1256 1258 1260 1270 1271 1272 1273 1274 1282 1285 1286 1289 1297 1308 1335 1340 1342 1350 1352 1363 1366 1370 1372 1379 1380 ...
    1382 1383 1425 1476 1491 1577 1642 1648 1658 1787 1812 1830 1833 1869 1879 1892 ...
    1902 1939 1995 1996 1998 2026 2028 2029 2033 2042 2069 2083 2085 2086 2094 2095 2096 2102 2103 2107 2128 2132 2134 2135 2138 2140 2148 2203 2303 2306 2308 2326 2329 ...
    2444 2543 2545 2553 2719 2720 2737 2739 2793 2797 2801 2802 2807 2811 2814 2815 ...
    2821 2825 2830 2831 2875 2891 2914 2922 2924 2929 2931 2932 2933 2934 2935 2936 2942 2943 2944 2947 2948 2949 2951 2965 2973 2985 3022 3070 3121 3127 3205 ...
    3313 3318 3319 3323 3331 3357 3385 3395 3396 3409 3484 3500];   % 0.065534804753820
sym_excited = [105 528 531 554 565 674 ...
    705 777 785 787 788 792 795 798 893 912 943 951 952 962 1043 1058 1066 1075 1125 ...
    1214 1217 1256 1260 1270 1271 1285 1286 1335 1340 1350 1363 1366 1372 1380 ...
    1869 1833 1830 1787 1658 1642 1383 ...
    1939 1996 1998 2026 2042 2083 2085 2086 2094 2095 2107 2128 2135 2140 2308 ...
    2543 2720 2739 2797 2801 2802 2807 2811 2815 ...
    3205 2965 2951 2948 2944 2942 2935 2933 2931 2929 2922 2914 2875 2831 2830 2821 ...
    3318 3323 3331 3395 3396 3409];   % 0.031578947368421

length(intersect(inhibited,excited))    % 0.012903225806452

%%

zinx = find(all(CCR'==0));
CCR(zinx,:) = [];

cnt = zeros(1,size(CCR,1));
dno = 0;
for k = 1:size(CCR,1)
    if cnt(k) > 0
        continue
    end
    cc = abs(CCR-repmat(CCR(k,:),size(CCR,1),1));
    dinx = find(max(cc,[],2)<10e-5);
    dinx = setdiff(dinx,k);
    if ~isempty(dinx)
        cnt(dinx) = dno;
        dno = dno + 1;
    end
end

length(find(cnt>0))
